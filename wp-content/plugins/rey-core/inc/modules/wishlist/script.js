!function(n){"use strict";var e=function(){this.cookie_key="rey_wishlist_ids_"+n.reyHelpers.params.site_id,this.logged_in=n("body").hasClass("logged-in"),this.init=function(){this.cleanupPage(),this.updateCounters(),this.events()},this.events=function(){var o=this;n(".rey-wishlistBtn").on("click",function(e){e.preventDefault();var t=n(this),s=parseInt(t.attr("data-id")||""),i=o.getProducts(),r=n(".rey-wishlistBtn-text",t);if(!isNaN(s)){if(t.hasClass("--supports-ajax")&&t.addClass("--doing"),t.hasClass("--in-wishlist")){var a=i.indexOf(s);if(-1!==a)return o.removeProduct(s,a),t.removeClass("--in-wishlist"),t.attr({title:n.reyHelpers.params.wishlist_text_add,"aria-label":n.reyHelpers.params.wishlist_text_add}),void(r.length&&r.text(n.reyHelpers.params.wishlist_text_add))}o.setProduct(s),t.addClass("--in-wishlist"),t.attr({title:n.reyHelpers.params.wishlist_text_rm,"aria-label":n.reyHelpers.params.wishlist_text_rm}),r.length&&r.text(n.reyHelpers.params.wishlist_text_rm)}}),n(".rey-wishlist-removeBtn").on("click",function(e){e.preventDefault();var t=n(this),s=parseInt(t.attr("data-id")||""),i=o.getProducts();if(!isNaN(s)){t.hasClass("--supports-ajax")&&t.addClass("--doing");var r=i.indexOf(s);-1!==r&&(o.removeProduct(s,r),t.closest("li.product").fadeOut(500,function(){n(this).remove()}))}}),n(document).on("click",".rey-wishlistItem-remove",function(e){e.preventDefault();var t=n(this),s=parseInt(t.attr("data-id")||""),i=o.getProducts();if(!isNaN(s)){var r=i.indexOf(s);-1!==r&&(o.removeProduct(s,r,!0),t.closest(".rey-wishlistItem").fadeOut(500,function(){n(this).remove()}),n(".rey-wishlistBtn.--in-wishlist[data-id="+s+"]").removeClass("--in-wishlist").attr({title:n.reyHelpers.params.wishlist_text_add,"aria-label":n.reyHelpers.params.wishlist_text_add}))}}),n(document).on("reycore/woocommerce/wishlist/added_product reycore/woocommerce/wishlist/removed_product",function(e,t,s){o.updateCounters(t),o.save(t),o.logged_in||o.animateBtn(s),o.cleanupPage()}),n(document).on("reycore/woocommerce/after_login",function(e,t){o.getSavedProducts()})},this.cleanupPage=function(){var e=n("body.rey-wishlist-page .rey-pageContent");e.length&&n(".woocommerce-notices-wrapper, .rey-loopHeader, ul.products:empty",e).remove()},this.animateBtn=function(e){var t=this,s=n(e?".rey-wishlistBtn[data-id="+e+"]":".rey-wishlistBtn.--doing");s.addClass("--animate"),setTimeout(function(){s.removeClass("--animate"),"notice"===n.reyHelpers.params.wishlist_after_add&&t.showNotice(s)},500)},this.showNotice=function(e){if(e.hasClass("--in-wishlist")){var t=n(".rey-wishlist-notice-wrapper");t.addClass("--visible");var s=new function(e,t){var s,i,r=t;this.pause=function(){window.clearTimeout(s),r-=Date.now()-i},this.resume=function(){i=Date.now(),window.clearTimeout(s),s=window.setTimeout(e,r)},this.resume()}(function(){t.removeClass("--visible")},3200);s.resume(),n(".rey-wishlist-notice",t).on("mouseenter",function(){s.pause()}).on("mouseleave",function(){s.resume()})}},this.updateCounters=function(e){e||(e=this.getProducts());var t=n(".rey-wishlistCounter-number"),s=e.length;s?t.text(s).removeClass("--empty"):t.text("").addClass("--empty")},this.save=function(e){if(e||(e=this.getProducts()),this.logged_in&&(n.reyHelpers.params.ajaxurl||n.reyHelpers.params.ajax_nonce)){var t=this;n(".rey-wishlistBtn").addClass("--disabled"),n.ajax({url:n.reyHelpers.params.ajaxurl,dataType:"json",cache:!1,data:{action:"rey_wishlist_add_to_user_meta",security:n.reyHelpers.params.ajax_nonce},success:function(e){t.animateBtn(),n(".rey-wishlistBtn").removeClass("--disabled --doing")},error:function(e,t,s){console.error(e),console.error(t),console.error(s)}})}},this.getProducts=function(){var e=Cookies.get(this.cookie_key);return e?e.split("|").map(function(e){return parseInt(e)}):[]},this.getSavedProducts=function(){if(n.reyHelpers.params.ajaxurl||n.reyHelpers.params.ajax_nonce){this.logged_in=!0;var i=this;n.ajax({url:n.reyHelpers.params.ajaxurl,dataType:"json",cache:!1,data:{action:"get_wishlist_data",security:n.reyHelpers.params.ajax_nonce},success:function(e){if(e&&e.success){var t=e.data;if(t.length){var s=t.map(function(e){return e.id});Cookies.set(i.cookie_key,s.join("|")),i.updateCounters(s),n(".rey-wishlistBtn").removeClass("--supports-ajax --in-wishlist"),n.each(s,function(e,t){var s=n(".rey-wishlistBtn[data-id="+t+"]");s.addClass("--in-wishlist"),i.logged_in&&s.addClass("--supports-ajax")}),n(document).trigger("reycore/woocommerce/wishlist/get_saved_products",[t])}}},error:function(e,t,s){console.error(e),console.error(t),console.error(s)}})}},this.setProduct=function(e){e=parseInt(e);var t=this.getProducts();-1===t.indexOf(e)&&(t.push(e),Cookies.set(this.cookie_key,t.join("|")),n(document).trigger("reycore/woocommerce/wishlist/added_product",[t,e]))},this.removeProduct=function(e,t,s){e=parseInt(e);var i=this.getProducts();i.splice(t,1),Cookies.set(this.cookie_key,i.join("|")),s||n(document).trigger("reycore/woocommerce/wishlist/removed_product",[i,e])},this.init()};n(document).ready(function(){n.reyWishlist=new e})}(jQuery);