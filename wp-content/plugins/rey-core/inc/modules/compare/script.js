!function(n){"use strict";var e=function(){this.cookie_key="rey_compare_ids_"+n.reyHelpers.params.site_id,this.logged_in=n("body").hasClass("logged-in"),this.init=function(){this.$recentBtn=n(".rey-compare-recentBtn"),this.$recentProducts=n(".rey-compareNotice-recentProducts"),this.$recentProductsList=n(".rey-compareNotice-recentProducts-inner"),this.$afterPanel=n(".rey-compareNotice-wrapper"),this.$panelTitle=n(".rey-compareTitle"),this.$pageTable=n(".rey-comparePage-table"),this.$pageTableScroll=n(".rey-comparePage-scroll"),this.cleanupPage(),this.updateCounters(),this.drag_events(),this.events()},this.events=function(){var c=this;n(".rey-compareBtn").on("click",function(e){e.preventDefault();var r=n(this),t=parseInt(r.attr("data-id")||""),a=c.getProducts(),o=n(".rey-compareBtn-text",r);if(!isNaN(t)){if(r.hasClass("--supports-ajax")&&r.addClass("--doing"),r.hasClass("--in-compare")){var s=a.indexOf(t);if(-1!==s)return c.removeProduct(t,s),r.removeClass("--in-compare"),r.attr({title:n.reyHelpers.params.compare_text_add,"aria-label":n.reyHelpers.params.compare_text_add,"data-tooltip-text":n.reyHelpers.params.compare_text_add}),void(o.length&&o.text(n.reyHelpers.params.compare_text_add))}c.showNotice(),c.setProduct(t),r.addClass("--in-compare"),r.attr({title:n.reyHelpers.params.compare_text_rm,"aria-label":n.reyHelpers.params.compare_text_rm,"data-tooltip-text":n.reyHelpers.params.compare_text_rm}),o.length&&o.text(n.reyHelpers.params.compare_text_rm)}}),n(".rey-compare-removeBtn").on("click",function(e){e.preventDefault();var r=n(this),t=parseInt(r.attr("data-id")||""),a=c.getProducts();if(!isNaN(t)){var o=a.indexOf(t);-1!==o&&(c.removeProduct(t,o),n("td[data-id="+t+"], th[data-id="+t+"]",c.$pageTable).remove())}}),this.$recentBtn.on("click",function(e){e.preventDefault();var r=n(this);if(r.addClass("--disabled"),c.$recentProducts.hasClass("--visible"))return r.removeClass("--disabled"),c.$recentProducts.removeClass("--visible"),void c.$recentProductsList.empty();c.getRecentProducts()}),n(document).on("click",".rey-compare-recentProducts-add",function(e){e.preventDefault();var r=n(this),t=r.attr("data-id")||"";t&&(c.setProduct(t),r.addClass("--disabled"))}),n(".rey-compare-resetBtn").on("click",function(e){e.preventDefault(),c.removeAll(),c.updateCounters(),c.save(),n(".rey-compareBtn").removeClass("--in-compare"),setTimeout(function(){n(".rey-compareNotice-wrapper").removeClass("--visible")},1e3)}),n(".rey-compareClose").on("click",function(e){e.preventDefault(),c.hideNotice()}),n(document).on("keyup",function(e){27==e.keyCode&&c.hideNotice()}),n(document).on("reycore/woocommerce/compare/added_product reycore/woocommerce/compare/removed_product",function(e,r,t){c.updateCounters(r),c.save(r),c.logged_in||c.animateBtn(t),c.cleanupPage()}),n(document).on("reycore/woocommerce/after_login",function(e,r){c.getSavedProducts()})},this.drag_events=function(){if(n.reyHelpers.is_desktop){var t,a,o=this.$pageTableScroll,s=!1;o.on("mousedown",function(e){s=!0,o.addClass("--active"),t=e.pageX-o.offset().left,a=o[0].scrollLeft}),o.on("mouseleave",function(){s=!1,o.removeClass("--active")}),o.on("mouseup",function(){s=!1,o.removeClass("--active")}),o.on("mousemove",function(e){if(s){e.preventDefault();var r=3*(e.pageX-o.offset().left-t);o.scrollLeft(a-r)}})}},this.cleanupPage=function(){var e=n("body.rey-compare-page .rey-pageContent");if(e.length){n(".woocommerce-notices-wrapper, .rey-loopHeader",e).remove();var r=this.getProducts();r.length?n.reyHelpers.setProperty("--products-count",r.length,this.$pageTable[0]):n(".rey-comparePage-wrapper",e).remove()}},this.animateBtn=function(e){var r=n(e?".rey-compareBtn[data-id="+e+"]":".rey-compareBtn.--doing");r.addClass("--animate"),this.logged_in&&this.$panelTitle.removeClass("--loading"),setTimeout(function(){r.removeClass("--animate")},500)},this.showNotice=function(){"notice"===n.reyHelpers.params.compare_after_add&&(this.$afterPanel.addClass("--visible"),this.logged_in&&this.$panelTitle.addClass("--loading"))},this.hideNotice=function(){"notice"===n.reyHelpers.params.compare_after_add&&(this.$afterPanel.removeClass("--visible"),this.$recentProducts.removeClass("--visible"))},this.updateCounters=function(e){e||(e=this.getProducts());var r=n(".rey-compareCounter-number"),t=e.length;t?r.text(t).removeClass("--empty"):r.text("0").addClass("--empty")},this.save=function(e){if(e||(e=this.getProducts()),this.logged_in&&(n.reyHelpers.params.ajaxurl||n.reyHelpers.params.ajax_nonce)){var r=this;n(".rey-compareBtn").addClass("--disabled"),n.ajax({url:n.reyHelpers.params.ajaxurl,dataType:"json",cache:!1,data:{action:"rey_compare_add_to_user_meta",security:n.reyHelpers.params.ajax_nonce},success:function(e){r.animateBtn(),n(".rey-compareBtn").removeClass("--disabled --doing")},error:function(e,r,t){console.error(e),console.error(r),console.error(t)}})}},this.getRecentProducts=function(){if(n.reyHelpers.params.ajaxurl||n.reyHelpers.params.ajax_nonce){var a=this;this.$recentProducts.addClass("--loading --visible"),n.ajax({url:n.reyHelpers.params.ajaxurl,dataType:"json",cache:!1,data:{action:"rey_compare_get_viewed_products",security:n.reyHelpers.params.ajax_nonce},success:function(e){if(e&&e.success){var t=a.$recentProductsList.html(e.data);a.$recentProducts.removeClass("--loading");var r=a.getProducts();n.each(r,function(e,r){n(".rey-compare-recentProducts-add[data-id="+r+"]",t).addClass("--disabled")}),"undefined"!=typeof SimpleScrollbar&&SimpleScrollbar.initEl(n(".rey-compare-recentProducts",t)[0])}},error:function(e,r,t){console.error(e),console.error(r),console.error(t)}})}},this.getProducts=function(){var e=Cookies.get(this.cookie_key);return e?e.split("|").map(function(e){return parseInt(e)}):[]},this.getSavedProducts=function(){if(n.reyHelpers.params.ajaxurl||n.reyHelpers.params.ajax_nonce){this.logged_in=!0;var a=this;n.ajax({url:n.reyHelpers.params.ajaxurl,dataType:"json",cache:!1,data:{action:"get_compare_data",security:n.reyHelpers.params.ajax_nonce},success:function(e){if(e&&e.success){var r=e.data;if(r.length){var t=r.map(function(e){return e.id});Cookies.set(a.cookie_key,t.join("|")),a.updateCounters(t),n(".rey-compareBtn").removeClass("--supports-ajax --in-compare"),n.each(t,function(e,r){var t=n(".rey-compareBtn[data-id="+r+"]");t.addClass("--in-compare"),a.logged_in&&t.addClass("--supports-ajax")}),n(document).trigger("reycore/woocommerce/compare/get_saved_products",[r])}}},error:function(e,r,t){console.error(e),console.error(r),console.error(t)}})}},this.setProduct=function(e){e=parseInt(e);var r=this.getProducts();-1===r.indexOf(e)&&(r.push(e),Cookies.set(this.cookie_key,r.join("|")),n(document).trigger("reycore/woocommerce/compare/added_product",[r,e]))},this.removeProduct=function(e,r,t){e=parseInt(e);var a=this.getProducts();a.splice(r,1),Cookies.set(this.cookie_key,a.join("|")),t||n(document).trigger("reycore/woocommerce/compare/removed_product",[a,e])},this.removeAll=function(){Cookies.set(this.cookie_key,"")},this.init()};n(document).ready(function(){n.reyCompare=new e})}(jQuery);